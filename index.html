<!doctype html>
<html lang="fr" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task Manager Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Space Grotesk', sans-serif;
    }
    
    .scrollbar-thin::-webkit-scrollbar {
      width: 6px;
    }
    
    .scrollbar-thin::-webkit-scrollbar-track {
      background: #1a1a2e;
    }
    
    .scrollbar-thin::-webkit-scrollbar-thumb {
      background: #3b82f6;
      border-radius: 3px;
    }
    
    .task-card {
      transition: all 0.2s ease;
    }
    
    .task-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15);
    }
    
    .sidebar-item {
      transition: all 0.2s ease;
    }
    
    .sidebar-item:hover, .sidebar-item.active {
      background: linear-gradient(90deg, rgba(59, 130, 246, 0.2) 0%, transparent 100%);
      border-left: 3px solid #3b82f6;
    }
    
    .modal-backdrop {
      backdrop-filter: blur(4px);
    }
    
    .pulse-dot {
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .category-badge {
      font-size: 0.65rem;
      letter-spacing: 0.05em;
    }
    
    .priority-indicator {
      width: 4px;
      border-radius: 2px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-[#0a0a0f] text-white overflow-hidden">
  <div id="app" class="h-full flex"><!-- Sidebar -->
   <aside id="sidebar" class="w-64 bg-[#0f0f18] border-r border-[#1a1a2e] flex flex-col h-full"><!-- Logo -->
    <div class="p-6 border-b border-[#1a1a2e]">
     <h1 id="app-title" class="text-xl font-bold bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent">Task Manager Pro</h1>
     <p class="text-xs text-gray-500 mt-1">Gestion intelligente</p>
    </div><!-- Navigation -->
    <nav class="flex-1 py-4 overflow-y-auto scrollbar-thin">
     <div class="px-3 mb-6">
      <p class="text-[10px] uppercase tracking-wider text-gray-600 px-3 mb-2">Navigation</p><button onclick="setView('dashboard')" id="nav-dashboard" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-gray-300 hover:text-white">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path>
       </svg><span id="dashboard-label">Tableau de bord</span> </button> <button onclick="setView('tasks')" id="nav-tasks" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-gray-300 hover:text-white">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
       </svg><span id="tasks-label">T√¢ches</span> <span id="tasks-count" class="ml-auto bg-blue-600/20 text-blue-400 text-xs px-2 py-0.5 rounded-full">0</span> </button> <button onclick="setView('completed')" id="nav-completed" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-gray-300 hover:text-white">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
       </svg><span>T√¢ches r√©alis√©es</span> <span id="completed-count" class="ml-auto bg-green-600/20 text-green-400 text-xs px-2 py-0.5 rounded-full">0</span> </button>
     </div><!-- Categories -->
     <div class="px-3 mb-6">
      <p class="text-[10px] uppercase tracking-wider text-gray-600 px-3 mb-2">Cat√©gories</p><button onclick="filterByCategory('urgent-important')" id="cat-urgent-important" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-gray-300 hover:text-white"> <span class="w-2 h-2 rounded-full bg-red-500"></span> <span class="truncate">Urgent &amp; Important</span> </button> <button onclick="filterByCategory('urgent-not-important')" id="cat-urgent-not-important" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-gray-300 hover:text-white"> <span class="w-2 h-2 rounded-full bg-orange-500"></span> <span class="truncate">Urgent &amp; Non important</span> </button> <button onclick="filterByCategory('not-urgent-important')" id="cat-not-urgent-important" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-gray-300 hover:text-white"> <span class="w-2 h-2 rounded-full bg-blue-500"></span> <span class="truncate">Important &amp; Non urgent</span> </button> <button onclick="filterByCategory('not-urgent-not-important')" id="cat-not-urgent-not-important" class="sidebar-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm text-gray-300 hover:text-white"> <span class="w-2 h-2 rounded-full bg-gray-500"></span> <span class="truncate">Non urgent &amp; Non important</span> </button>
     </div><!-- User Selector -->
     <div class="px-3">
      <p class="text-[10px] uppercase tracking-wider text-gray-600 px-3 mb-2">Utilisateur</p>
      <div class="space-y-1"><button onclick="filterByUser('all')" id="user-all" class="sidebar-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-300 hover:text-white">
        <div class="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center text-[10px] font-bold">
         üë•
        </div><span>Tous</span> </button> <button onclick="filterByUser('Bryan')" id="user-Bryan" class="sidebar-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-300 hover:text-white">
        <div class="w-6 h-6 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-[10px] font-bold">
         B
        </div><span>Bryan</span> </button> <button onclick="filterByUser('Ugo')" id="user-Ugo" class="sidebar-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-300 hover:text-white">
        <div class="w-6 h-6 rounded-full bg-gradient-to-br from-green-500 to-emerald-500 flex items-center justify-center text-[10px] font-bold">
         U
        </div><span>Ugo</span> </button> <button onclick="filterByUser('Iban')" id="user-Iban" class="sidebar-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-300 hover:text-white">
        <div class="w-6 h-6 rounded-full bg-gradient-to-br from-orange-500 to-amber-500 flex items-center justify-center text-[10px] font-bold">
         I
        </div><span>Iban</span> </button> <button onclick="filterByUser('Thomas')" id="user-Thomas" class="sidebar-item w-full flex items-center gap-3 px-3 py-2 rounded-lg text-sm text-gray-300 hover:text-white">
        <div class="w-6 h-6 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-[10px] font-bold">
         T
        </div><span>Thomas</span> </button>
      </div>
     </div>
    </nav><!-- Stats Footer -->
    <div class="p-4 border-t border-[#1a1a2e]">
     <div class="bg-[#1a1a2e] rounded-lg p-3">
      <div class="flex items-center justify-between text-xs"><span class="text-gray-500">Total t√¢ches</span> <span id="total-tasks" class="text-white font-semibold">0</span>
      </div>
      <div class="flex items-center justify-between text-xs mt-2"><span class="text-gray-500">Compl√©t√©es</span> <span id="completion-rate" class="text-green-400 font-semibold">0%</span>
      </div>
     </div>
    </div>
   </aside><!-- Main Content -->
   <main class="flex-1 flex flex-col h-full overflow-hidden"><!-- Top Bar -->
    <header class="bg-[#0f0f18] border-b border-[#1a1a2e] px-6 py-4">
     <div class="flex items-center justify-between gap-4"><!-- Search -->
      <div class="flex-1 max-w-md">
       <div class="relative">
        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg><input type="text" id="search-input" placeholder="Rechercher une t√¢che..." oninput="handleSearch(this.value)" class="w-full bg-[#1a1a2e] border border-[#252536] rounded-lg pl-10 pr-4 py-2.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-blue-500 transition-colors">
       </div>
      </div><!-- Filters -->
      <div class="flex items-center gap-2"><select id="filter-status" onchange="applyFilters()" class="bg-[#1a1a2e] border border-[#252536] rounded-lg px-3 py-2.5 text-sm text-gray-300 focus:outline-none focus:border-blue-500"> <option value="all">Tous les statuts</option> <option value="todo">√Ä faire</option> <option value="in-progress">En cours</option> </select> <select id="filter-urgency" onchange="applyFilters()" class="bg-[#1a1a2e] border border-[#252536] rounded-lg px-3 py-2.5 text-sm text-gray-300 focus:outline-none focus:border-blue-500"> <option value="all">Toute urgence</option> <option value="urgent">Urgent</option> <option value="not-urgent">Non urgent</option> </select>
      </div><!-- Create Button --> <button onclick="openModal()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg text-sm font-medium transition-colors">
       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
       </svg> Cr√©er une t√¢che </button>
     </div>
    </header><!-- Content Area -->
    <div id="content-area" class="flex-1 overflow-y-auto scrollbar-thin p-6"><!-- Dashboard View -->
     <div id="view-dashboard" class="hidden">
      <h2 class="text-2xl font-bold mb-6">Tableau de bord</h2><!-- Stats Cards -->
      <div class="grid grid-cols-4 gap-4 mb-8">
       <div class="bg-gradient-to-br from-red-500/10 to-red-600/5 border border-red-500/20 rounded-xl p-4">
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center">
          <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
         </div>
         <div>
          <p class="text-xs text-gray-500">Urgent &amp; Important</p>
          <p id="stat-urgent-important" class="text-2xl font-bold text-white">0</p>
         </div>
        </div>
       </div>
       <div class="bg-gradient-to-br from-orange-500/10 to-orange-600/5 border border-orange-500/20 rounded-xl p-4">
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center">
          <svg class="w-5 h-5 text-orange-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
         </div>
         <div>
          <p class="text-xs text-gray-500">Urgent &amp; Non important</p>
          <p id="stat-urgent-not-important" class="text-2xl font-bold text-white">0</p>
         </div>
        </div>
       </div>
       <div class="bg-gradient-to-br from-blue-500/10 to-blue-600/5 border border-blue-500/20 rounded-xl p-4">
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 rounded-lg bg-blue-500/20 flex items-center justify-center">
          <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
         </div>
         <div>
          <p class="text-xs text-gray-500">Important &amp; Non urgent</p>
          <p id="stat-not-urgent-important" class="text-2xl font-bold text-white">0</p>
         </div>
        </div>
       </div>
       <div class="bg-gradient-to-br from-gray-500/10 to-gray-600/5 border border-gray-500/20 rounded-xl p-4">
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 rounded-lg bg-gray-500/20 flex items-center justify-center">
          <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
          </svg>
         </div>
         <div>
          <p class="text-xs text-gray-500">Non urgent &amp; Non important</p>
          <p id="stat-not-urgent-not-important" class="text-2xl font-bold text-white">0</p>
         </div>
        </div>
       </div>
      </div><!-- Eisenhower Matrix -->
      <h3 class="text-lg font-semibold mb-4">Matrice d'Eisenhower</h3>
      <div class="grid grid-cols-2 gap-4 mb-8">
       <div class="bg-[#0f0f18] border border-red-500/30 rounded-xl p-4">
        <div class="flex items-center gap-2 mb-3"><span class="w-3 h-3 rounded-full bg-red-500"></span>
         <h4 class="text-sm font-medium text-red-400">Faire immÔøΩÔøΩdiatement</h4>
        </div>
        <div id="matrix-urgent-important" class="space-y-2 min-h-[100px]"></div>
       </div>
       <div class="bg-[#0f0f18] border border-blue-500/30 rounded-xl p-4">
        <div class="flex items-center gap-2 mb-3"><span class="w-3 h-3 rounded-full bg-blue-500"></span>
         <h4 class="text-sm font-medium text-blue-400">Planifier</h4>
        </div>
        <div id="matrix-not-urgent-important" class="space-y-2 min-h-[100px]"></div>
       </div>
       <div class="bg-[#0f0f18] border border-orange-500/30 rounded-xl p-4">
        <div class="flex items-center gap-2 mb-3"><span class="w-3 h-3 rounded-full bg-orange-500"></span>
         <h4 class="text-sm font-medium text-orange-400">D√©l√©guer</h4>
        </div>
        <div id="matrix-urgent-not-important" class="space-y-2 min-h-[100px]"></div>
       </div>
       <div class="bg-[#0f0f18] border border-gray-500/30 rounded-xl p-4">
        <div class="flex items-center gap-2 mb-3"><span class="w-3 h-3 rounded-full bg-gray-500"></span>
         <h4 class="text-sm font-medium text-gray-400">√âliminer</h4>
        </div>
        <div id="matrix-not-urgent-not-important" class="space-y-2 min-h-[100px]"></div>
       </div>
      </div>
     </div><!-- Tasks View -->
     <div id="view-tasks" class="hidden">
      <div class="flex items-center justify-between mb-6">
       <h2 class="text-2xl font-bold">T√¢ches actives</h2><button onclick="clearCategoryFilter()" id="clear-filter-btn" class="hidden text-sm text-blue-400 hover:text-blue-300">Effacer le filtre</button>
      </div>
      <div id="tasks-container" class="space-y-3"></div>
      <div id="empty-tasks" class="hidden flex flex-col items-center justify-center py-16">
       <div class="w-16 h-16 rounded-full bg-[#1a1a2e] flex items-center justify-center mb-4">
        <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
        </svg>
       </div>
       <p class="text-gray-500 text-sm">Aucune t√¢che active</p><button onclick="openModal()" class="mt-4 text-blue-400 hover:text-blue-300 text-sm">Cr√©er votre premi√®re t√¢che</button>
      </div>
     </div><!-- Completed View -->
     <div id="view-completed" class="hidden">
      <h2 class="text-2xl font-bold mb-6">T√¢ches r√©alis√©es</h2>
      <div id="completed-container" class="space-y-3"></div>
      <div id="empty-completed" class="hidden flex flex-col items-center justify-center py-16">
       <div class="w-16 h-16 rounded-full bg-[#1a1a2e] flex items-center justify-center mb-4">
        <svg class="w-8 h-8 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
       </div>
       <p class="text-gray-500 text-sm">Aucune t√¢che compl√©t√©e</p>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Create/Edit Modal -->
  <div id="task-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
   <div class="absolute inset-0 bg-black/60 modal-backdrop" onclick="closeModal()"></div>
   <div class="relative bg-[#0f0f18] border border-[#252536] rounded-2xl w-full max-w-lg mx-4 shadow-2xl">
    <div class="p-6 border-b border-[#252536]">
     <h3 id="modal-title" class="text-lg font-semibold">Cr√©er une t√¢che</h3>
    </div>
    <form id="task-form" onsubmit="handleSubmit(event)" class="p-6 space-y-4"><input type="hidden" id="task-id">
     <div><label for="task-title" class="block text-sm text-gray-400 mb-1.5">Titre *</label> <input type="text" id="task-title" required placeholder="Ex: Finaliser le rapport Q4" class="w-full bg-[#1a1a2e] border border-[#252536] rounded-lg px-4 py-2.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-blue-500">
     </div>
     <div><label for="task-description" class="block text-sm text-gray-400 mb-1.5">Description</label> <textarea id="task-description" rows="3" placeholder="D√©tails de la t√¢che..." class="w-full bg-[#1a1a2e] border border-[#252536] rounded-lg px-4 py-2.5 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-blue-500 resize-none"></textarea>
     </div>
     <div class="grid grid-cols-2 gap-4">
      <div><label for="task-user" class="block text-sm text-gray-400 mb-1.5">Assign√© √†</label> <select id="task-user" class="w-full bg-[#1a1a2e] border border-[#252536] rounded-lg px-4 py-2.5 text-sm text-white focus:outline-none focus:border-blue-500"> <option value="Bryan">Bryan</option> <option value="Ugo">Ugo</option> <option value="Iban">Iban</option> <option value="Thomas">Thomas</option> </select>
      </div>
      <div><label for="task-due-date" class="block text-sm text-gray-400 mb-1.5">Date limite</label> <input type="date" id="task-due-date" class="w-full bg-[#1a1a2e] border border-[#252536] rounded-lg px-4 py-2.5 text-sm text-white focus:outline-none focus:border-blue-500">
      </div>
     </div>
     <div class="flex gap-6"><label class="flex items-center gap-3 cursor-pointer">
       <div class="relative"><input type="checkbox" id="task-urgent" class="sr-only peer">
        <div class="w-10 h-6 bg-[#1a1a2e] rounded-full peer peer-checked:bg-red-600 transition-colors"></div>
        <div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full peer-checked:translate-x-4 transition-transform"></div>
       </div><span class="text-sm text-gray-300">Urgent</span> </label> <label class="flex items-center gap-3 cursor-pointer">
       <div class="relative"><input type="checkbox" id="task-important" class="sr-only peer">
        <div class="w-10 h-6 bg-[#1a1a2e] rounded-full peer peer-checked:bg-blue-600 transition-colors"></div>
        <div class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full peer-checked:translate-x-4 transition-transform"></div>
       </div><span class="text-sm text-gray-300">Important</span> </label>
     </div>
     <div class="flex justify-end gap-3 pt-4"><button type="button" onclick="closeModal()" class="px-5 py-2.5 text-sm text-gray-400 hover:text-white transition-colors">Annuler</button> <button type="submit" id="submit-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg text-sm font-medium transition-colors flex items-center gap-2"> <span id="submit-text">Cr√©er</span>
       <svg id="submit-spinner" class="hidden w-4 h-4 animate-spin" fill="none" viewbox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
       </svg></button>
     </div>
    </form>
   </div>
  </div><!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center">
   <div class="absolute inset-0 bg-black/60 modal-backdrop" onclick="closeDeleteModal()"></div>
   <div class="relative bg-[#0f0f18] border border-[#252536] rounded-2xl w-full max-w-sm mx-4 shadow-2xl p-6">
    <div class="text-center">
     <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center mx-auto mb-4">
      <svg class="w-6 h-6 text-red-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
      </svg>
     </div>
     <h3 class="text-lg font-semibold mb-2">Supprimer cette t√¢che ?</h3>
     <p class="text-sm text-gray-500 mb-6">Cette action est irr√©versible.</p>
     <div class="flex gap-3"><button onclick="closeDeleteModal()" class="flex-1 px-4 py-2.5 text-sm text-gray-400 hover:text-white border border-[#252536] rounded-lg transition-colors">Annuler</button> <button onclick="confirmDelete()" id="confirm-delete-btn" class="flex-1 px-4 py-2.5 text-sm text-white bg-red-600 hover:bg-red-700 rounded-lg transition-colors flex items-center justify-center gap-2"> <span>Supprimer</span>
       <svg id="delete-spinner" class="hidden w-4 h-4 animate-spin" fill="none" viewbox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
       </svg></button>
     </div>
    </div>
   </div>
  </div><!-- Toast Notification -->
  <div id="toast" class="fixed bottom-6 right-6 transform translate-y-20 opacity-0 transition-all duration-300 z-50">
   <div class="bg-[#1a1a2e] border border-[#252536] rounded-lg px-4 py-3 shadow-xl flex items-center gap-3">
    <svg id="toast-icon-success" class="hidden w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg>
    <svg id="toast-icon-error" class="hidden w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewbox="0 0 24 24">
     <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
    </svg><span id="toast-message" class="text-sm text-white"></span>
   </div>
  </div>
  <script>
    // State
    let allTasks = [];
    let currentView = 'dashboard';
    let currentUserFilter = 'all';
    let currentCategoryFilter = null;
    let searchQuery = '';
    let taskToDelete = null;
    
    // Default Config
    const defaultConfig = {
      app_title: 'Frobry Manager Pro',
      dashboard_label: 'Tableau de bord',
      tasks_label: 'T√¢ches',
      background_color: '#0a0a0f',
      surface_color: '#0f0f18',
      text_color: '#ffffff',
      primary_action_color: '#3b82f6',
      secondary_action_color: '#6b7280'
    };
    
    // Element SDK Setup
    const elementApi = {
      defaultConfig,
      onConfigChange: async (config) => {
        const title = document.getElementById('app-title');
        const dashboardLabel = document.getElementById('dashboard-label');
        const tasksLabel = document.getElementById('tasks-label');
        
        if (title) title.textContent = config.app_title || defaultConfig.app_title;
        if (dashboardLabel) dashboardLabel.textContent = config.dashboard_label || defaultConfig.dashboard_label;
        if (tasksLabel) tasksLabel.textContent = config.tasks_label || defaultConfig.tasks_label;
        
        // Apply colors
        document.body.style.backgroundColor = config.background_color || defaultConfig.background_color;
        document.getElementById('sidebar').style.backgroundColor = config.surface_color || defaultConfig.surface_color;
      },
      mapToCapabilities: (config) => ({
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (v) => { config.background_color = v; window.elementSdk.setConfig({ background_color: v }); }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (v) => { config.surface_color = v; window.elementSdk.setConfig({ surface_color: v }); }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (v) => { config.text_color = v; window.elementSdk.setConfig({ text_color: v }); }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (v) => { config.primary_action_color = v; window.elementSdk.setConfig({ primary_action_color: v }); }
          },
          {
            get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
            set: (v) => { config.secondary_action_color = v; window.elementSdk.setConfig({ secondary_action_color: v }); }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      }),
      mapToEditPanelValues: (config) => new Map([
        ['app_title', config.app_title || defaultConfig.app_title],
        ['dashboard_label', config.dashboard_label || defaultConfig.dashboard_label],
        ['tasks_label', config.tasks_label || defaultConfig.tasks_label]
      ])
    };
    
    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        allTasks = data;
        updateUI();
      }
    };
    
    // Initialize SDKs
    async function init() {
      if (window.elementSdk) {
        window.elementSdk.init(elementApi);
      }
      
      // Check if Data SDK is available and functional
      if (window.dataSdk && typeof window.dataSdk.init === 'function') {
        try {
          const result = await Promise.race([
            window.dataSdk.init(dataHandler),
            new Promise((_, reject) => 
              setTimeout(() => reject(new Error('Data SDK timeout')), 3000)
            )
          ]);
          
          if (!result.isOk) {
            console.warn('Data SDK initialization failed, switching to local mode');
            enableLocalMode();
          }
        } catch (error) {
          console.warn('Data SDK unavailable, switching to local mode:', error.message);
          enableLocalMode();
        }
      } else {
        console.warn('Data SDK not available, switching to local mode');
        enableLocalMode();
      }
      
      setView('dashboard');
    }
    
    // Local Mode for published versions
    function enableLocalMode() {
      window.isLocalMode = true;
      allTasks = JSON.parse(localStorage.getItem('frobry_tasks') || '[]');
      updateUI();
      showNotification('Mode local activ√© - les donn√©es seront conserv√©es dans cette session');
    }
    
    function showNotification(message) {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const successIcon = document.getElementById('toast-icon-success');
      const errorIcon = document.getElementById('toast-icon-error');
      
      toastMessage.textContent = message;
      successIcon.classList.add('hidden');
      errorIcon.classList.add('hidden');
      
      // Show info icon instead
      const infoIcon = document.createElement('svg');
      infoIcon.className = 'w-5 h-5 text-blue-400';
      infoIcon.setAttribute('fill', 'none');
      infoIcon.setAttribute('stroke', 'currentColor');
      infoIcon.setAttribute('viewBox', '0 0 24 24');
      infoIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
      
      toast.classList.remove('translate-y-20', 'opacity-0');
      
      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
      }, 4000);
    }
    
    // View Management
    function setView(view) {
      currentView = view;
      currentCategoryFilter = null;
      
      document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
      document.getElementById(`view-${view}`).classList.remove('hidden');
      
      document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
      document.getElementById(`nav-${view}`)?.classList.add('active');
      
      document.getElementById('clear-filter-btn').classList.add('hidden');
      
      updateUI();
    }
    
    // Category Helpers
    function getCategory(task) {
      const isUrgent = task.is_urgent === true || task.is_urgent === 'true' || task.is_urgent === 1;
      const isImportant = task.is_important === true || task.is_important === 'true' || task.is_important === 1;
      
      if (isUrgent && isImportant) return 'urgent-important';
      if (isUrgent && !isImportant) return 'urgent-not-important';
      if (!isUrgent && isImportant) return 'not-urgent-important';
      return 'not-urgent-not-important';
    }
    
    function getCategoryLabel(category) {
      const labels = {
        'urgent-important': 'Urgent & Important',
        'urgent-not-important': 'Urgent & Non important',
        'not-urgent-important': 'Important & Non urgent',
        'not-urgent-not-important': 'Non urgent & Non important'
      };
      return labels[category] || category;
    }
    
    function getCategoryColor(category) {
      const colors = {
        'urgent-important': 'bg-red-500',
        'urgent-not-important': 'bg-orange-500',
        'not-urgent-important': 'bg-blue-500',
        'not-urgent-not-important': 'bg-gray-500'
      };
      return colors[category] || 'bg-gray-500';
    }
    
    function getPriorityColor(category) {
      const colors = {
        'urgent-important': 'bg-red-500',
        'urgent-not-important': 'bg-orange-500',
        'not-urgent-important': 'bg-blue-500',
        'not-urgent-not-important': 'bg-gray-600'
      };
      return colors[category] || 'bg-gray-600';
    }
    
    function calculatePriority(task) {
      const isUrgent = task.is_urgent === true || task.is_urgent === 'true' || task.is_urgent === 1;
      const isImportant = task.is_important === true || task.is_important === 'true' || task.is_important === 1;
      
      let priority = 0;
      if (isUrgent) priority += 2;
      if (isImportant) priority += 1;
      return priority;
    }
    
    function getAIRecommendation(task) {
      if (getCategory(task) !== 'not-urgent-not-important') return null;
      
      const daysSinceCreation = Math.floor((Date.now() - new Date(task.created_at).getTime()) / (1000 * 60 * 60 * 24));
      const hasDueDate = !!task.due_date;
      
      if (daysSinceCreation > 7 && !hasDueDate) {
        return { action: 'Supprimer', reason: 'T√¢che inactive depuis +7 jours sans √©ch√©ance' };
      }
      if (daysSinceCreation > 14) {
        return { action: 'Supprimer', reason: 'T√¢che inactive depuis +14 jours' };
      }
      return { action: 'Conserver', reason: 'T√¢che r√©cente ou avec √©ch√©ance d√©finie' };
    }
    
    // Filtering
    function filterByUser(user) {
      currentUserFilter = user;
      
      document.querySelectorAll('[id^="user-"]').forEach(el => el.classList.remove('active'));
      document.getElementById(`user-${user}`)?.classList.add('active');
      
      updateUI();
    }
    
    function filterByCategory(category) {
      currentCategoryFilter = category;
      currentView = 'tasks';
      
      // Update view display
      document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
      document.getElementById('view-tasks').classList.remove('hidden');
      
      // Update nav highlighting
      document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('active'));
      
      // Show clear filter button
      document.getElementById('clear-filter-btn').classList.remove('hidden');
      
      updateUI();
    }
    
    function clearCategoryFilter() {
      currentCategoryFilter = null;
      document.getElementById('clear-filter-btn').classList.add('hidden');
      updateUI();
    }
    
    function handleSearch(query) {
      searchQuery = query.toLowerCase();
      updateUI();
    }
    
    function applyFilters() {
      updateUI();
    }
    
    function getFilteredTasks(tasks, includeCompleted = false) {
      // Start with status filter
      let filtered = tasks.filter(t => includeCompleted ? t.status === 'completed' : t.status !== 'completed' && t.status !== 'deleted');
      
      // Apply category filter STRICTLY (must match exact category)
      if (currentCategoryFilter) {
        filtered = filtered.filter(t => {
          const taskCategory = getCategory(t);
          return taskCategory === currentCategoryFilter;
        });
      }
      
      // Apply user filter
      if (currentUserFilter !== 'all') {
        filtered = filtered.filter(t => t.assigned_user === currentUserFilter);
      }
      
      // Apply search filter
      if (searchQuery) {
        filtered = filtered.filter(t => 
          t.title.toLowerCase().includes(searchQuery) || 
          (t.description && t.description.toLowerCase().includes(searchQuery))
        );
      }
      
      // Apply status filter from dropdown
      const statusFilter = document.getElementById('filter-status')?.value;
      if (statusFilter && statusFilter !== 'all') {
        filtered = filtered.filter(t => t.status === statusFilter);
      }
      
      // Apply urgency filter from dropdown
      const urgencyFilter = document.getElementById('filter-urgency')?.value;
      if (urgencyFilter && urgencyFilter !== 'all') {
        if (urgencyFilter === 'urgent') {
          filtered = filtered.filter(t => t.is_urgent === true || t.is_urgent === 'true' || t.is_urgent === 1);
        } else {
          filtered = filtered.filter(t => t.is_urgent !== true && t.is_urgent !== 'true' && t.is_urgent !== 1);
        }
      }
      
      // Sort by priority (highest first)
      filtered.sort((a, b) => calculatePriority(b) - calculatePriority(a));
      
      return filtered;
    }
    
    // UI Update
    function updateUI() {
      const activeTasks = allTasks.filter(t => t.status !== 'completed' && t.status !== 'deleted');
      const completedTasks = allTasks.filter(t => t.status === 'completed');
      
      // Update counts
      document.getElementById('tasks-count').textContent = activeTasks.length;
      document.getElementById('completed-count').textContent = completedTasks.length;
      document.getElementById('total-tasks').textContent = allTasks.filter(t => t.status !== 'deleted').length;
      
      const total = allTasks.filter(t => t.status !== 'deleted').length;
      const rate = total > 0 ? Math.round((completedTasks.length / total) * 100) : 0;
      document.getElementById('completion-rate').textContent = `${rate}%`;
      
      // Update stats
      const stats = {
        'urgent-important': activeTasks.filter(t => getCategory(t) === 'urgent-important').length,
        'urgent-not-important': activeTasks.filter(t => getCategory(t) === 'urgent-not-important').length,
        'not-urgent-important': activeTasks.filter(t => getCategory(t) === 'not-urgent-important').length,
        'not-urgent-not-important': activeTasks.filter(t => getCategory(t) === 'not-urgent-not-important').length
      };
      
      document.getElementById('stat-urgent-important').textContent = stats['urgent-important'];
      document.getElementById('stat-urgent-not-important').textContent = stats['urgent-not-important'];
      document.getElementById('stat-not-urgent-important').textContent = stats['not-urgent-important'];
      document.getElementById('stat-not-urgent-not-important').textContent = stats['not-urgent-not-important'];
      
      // Highlight category filter if active
      document.querySelectorAll('[id^="cat-"]').forEach(el => el.classList.remove('active'));
      if (currentCategoryFilter) {
        const categoryBtn = document.getElementById(`cat-${currentCategoryFilter}`);
        if (categoryBtn) {
          categoryBtn.classList.add('active');
        }
      }
      
      // Update views based on current view
      if (currentView === 'dashboard') {
        updateDashboard(activeTasks);
      } else if (currentView === 'tasks') {
        updateTasksList(getFilteredTasks(allTasks, false));
      } else if (currentView === 'completed') {
        updateCompletedList(getFilteredTasks(allTasks, true));
      }
    }
    
    function updateDashboard(tasks) {
      const categories = ['urgent-important', 'not-urgent-important', 'urgent-not-important', 'not-urgent-not-important'];
      
      categories.forEach(cat => {
        const container = document.getElementById(`matrix-${cat}`);
        const catTasks = tasks.filter(t => getCategory(t) === cat).slice(0, 3);
        
        if (catTasks.length === 0) {
          container.innerHTML = '<p class="text-xs text-gray-600 italic">Aucune t√¢che</p>';
        } else {
          container.innerHTML = catTasks.map(t => `
            <div class="bg-[#1a1a2e] rounded-lg p-2 text-xs">
              <p class="text-white truncate">${escapeHtml(t.title)}</p>
              <p class="text-gray-500 mt-1">${t.assigned_user}</p>
            </div>
          `).join('');
        }
      });
    }
    
    function updateTasksList(tasks) {
      const container = document.getElementById('tasks-container');
      const empty = document.getElementById('empty-tasks');
      
      if (tasks.length === 0) {
        container.innerHTML = '';
        empty.classList.remove('hidden');
        return;
      }
      
      empty.classList.add('hidden');
      
      container.innerHTML = tasks.map(task => {
        const category = getCategory(task);
        const aiRec = getAIRecommendation(task);
        const dueDate = task.due_date ? new Date(task.due_date).toLocaleDateString('fr-FR') : null;
        
        return `
          <div class="task-card bg-[#0f0f18] border border-[#252536] rounded-xl p-4 flex gap-4" data-task-id="${task.__backendId}">
            <div class="priority-indicator ${getPriorityColor(category)}"></div>
            <div class="flex-1 min-w-0">
              <div class="flex items-start justify-between gap-4">
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <h3 class="font-medium text-white truncate">${escapeHtml(task.title)}</h3>
                    <span class="category-badge ${getCategoryColor(category)} text-white px-2 py-0.5 rounded-full uppercase font-medium flex-shrink-0">${getCategoryLabel(category)}</span>
                  </div>
                  ${task.description ? `<p class="text-sm text-gray-500 line-clamp-2 mb-2">${escapeHtml(task.description)}</p>` : ''}
                  <div class="flex items-center gap-4 text-xs text-gray-500">
                    <span class="flex items-center gap-1">
                      <div class="w-4 h-4 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-[8px] font-bold text-white">${task.assigned_user.charAt(0)}</div>
                      ${task.assigned_user}
                    </span>
                    ${dueDate ? `<span class="flex items-center gap-1">
                      <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                      ${dueDate}
                    </span>` : ''}
                    <span class="flex items-center gap-1">
                      <span class="w-2 h-2 rounded-full ${task.status === 'in-progress' ? 'bg-yellow-500' : 'bg-gray-500'}"></span>
                      ${task.status === 'in-progress' ? 'En cours' : '√Ä faire'}
                    </span>
                  </div>
                  ${aiRec ? `
                    <div class="mt-3 p-2 rounded-lg ${aiRec.action === 'Supprimer' ? 'bg-red-500/10 border border-red-500/20' : 'bg-green-500/10 border border-green-500/20'}">
                      <div class="flex items-center gap-2">
                        <svg class="w-4 h-4 ${aiRec.action === 'Supprimer' ? 'text-red-400' : 'text-green-400'}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path></svg>
                        <span class="text-xs ${aiRec.action === 'Supprimer' ? 'text-red-400' : 'text-green-400'} font-medium">IA : ${aiRec.action}</span>
                        <span class="text-xs text-gray-500">‚Äî ${aiRec.reason}</span>
                      </div>
                    </div>
                  ` : ''}
                </div>
                <div class="flex items-center gap-1 flex-shrink-0">
                  <button onclick="completeTask('${task.__backendId}')" class="p-2 text-gray-500 hover:text-green-400 hover:bg-green-500/10 rounded-lg transition-colors" title="Terminer">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                  </button>
                  <button onclick="editTask('${task.__backendId}')" class="p-2 text-gray-500 hover:text-blue-400 hover:bg-blue-500/10 rounded-lg transition-colors" title="Modifier">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                  </button>
                  <button onclick="deleteTask('${task.__backendId}')" class="p-2 text-gray-500 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors" title="Supprimer">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }
    
    function updateCompletedList(tasks) {
      const container = document.getElementById('completed-container');
      const empty = document.getElementById('empty-completed');
      
      if (tasks.length === 0) {
        container.innerHTML = '';
        empty.classList.remove('hidden');
        return;
      }
      
      empty.classList.add('hidden');
      
      container.innerHTML = tasks.map(task => {
        const completedDate = task.completed_at ? new Date(task.completed_at).toLocaleDateString('fr-FR') : 'N/A';
        
        return `
          <div class="task-card bg-[#0f0f18] border border-[#252536] rounded-xl p-4 opacity-70" data-task-id="${task.__backendId}">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <div class="w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center">
                  <svg class="w-4 h-4 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                </div>
                <div>
                  <h3 class="font-medium text-white line-through">${escapeHtml(task.title)}</h3>
                  <p class="text-xs text-gray-500">${task.assigned_user} ‚Ä¢ Compl√©t√©e le ${completedDate}</p>
                </div>
              </div>
              <button onclick="restoreTask('${task.__backendId}')" class="p-2 text-gray-500 hover:text-blue-400 hover:bg-blue-500/10 rounded-lg transition-colors" title="Restaurer">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    // Modal Functions
    function openModal(taskId = null) {
      const modal = document.getElementById('task-modal');
      const title = document.getElementById('modal-title');
      const submitText = document.getElementById('submit-text');
      const form = document.getElementById('task-form');
      
      form.reset();
      document.getElementById('task-id').value = '';
      
      if (taskId) {
        const task = allTasks.find(t => t.__backendId === taskId);
        if (task) {
          title.textContent = 'Modifier la t√¢che';
          submitText.textContent = 'Enregistrer';
          document.getElementById('task-id').value = taskId;
          document.getElementById('task-title').value = task.title;
          document.getElementById('task-description').value = task.description || '';
          document.getElementById('task-user').value = task.assigned_user;
          document.getElementById('task-due-date').value = task.due_date ? task.due_date.split('T')[0] : '';
          document.getElementById('task-urgent').checked = task.is_urgent;
          document.getElementById('task-important').checked = task.is_important;
        }
      } else {
        title.textContent = 'Cr√©er une t√¢che';
        submitText.textContent = 'Cr√©er';
      }
      
      modal.classList.remove('hidden');
    }
    
    function closeModal() {
      document.getElementById('task-modal').classList.add('hidden');
    }
    
    function openDeleteModal(taskId) {
      taskToDelete = taskId;
      document.getElementById('delete-modal').classList.remove('hidden');
    }
    
    function closeDeleteModal() {
      taskToDelete = null;
      document.getElementById('delete-modal').classList.add('hidden');
    }
    
    // Task Actions
    async function handleSubmit(e) {
      e.preventDefault();
      
      if (allTasks.filter(t => t.status !== 'deleted').length >= 999) {
        showToast('Limite de 999 t√¢ches atteinte', 'error');
        return;
      }
      
      const submitBtn = document.getElementById('submit-btn');
      const submitText = document.getElementById('submit-text');
      const spinner = document.getElementById('submit-spinner');
      
      submitBtn.disabled = true;
      spinner.classList.remove('hidden');
      
      const taskId = document.getElementById('task-id').value;
      const isUrgent = document.getElementById('task-urgent').checked;
      const isImportant = document.getElementById('task-important').checked;
      
      const taskData = {
        title: document.getElementById('task-title').value,
        description: document.getElementById('task-description').value,
        assigned_user: document.getElementById('task-user').value,
        is_urgent: isUrgent,
        is_important: isImportant,
        category: getCategory({ is_urgent: isUrgent, is_important: isImportant }),
        priority: calculatePriority({ is_urgent: isUrgent, is_important: isImportant }),
        due_date: document.getElementById('task-due-date').value ? new Date(document.getElementById('task-due-date').value).toISOString() : ''
      };
      
      let result;
      
      if (window.isLocalMode) {
        // Local mode: save to localStorage
        if (taskId) {
          const existingTask = allTasks.find(t => t.__backendId === taskId);
          if (existingTask) {
            const aiRec = getAIRecommendation({ ...existingTask, ...taskData });
            const updated = {
              ...existingTask,
              ...taskData,
              ai_recommendation: aiRec?.action || '',
              ai_reasoning: aiRec?.reason || ''
            };
            const index = allTasks.findIndex(t => t.__backendId === taskId);
            allTasks[index] = updated;
            result = { isOk: true };
          }
        } else {
          const backendId = `local-${Date.now()}-${Math.random()}`;
          const aiRec = getAIRecommendation({ ...taskData, created_at: new Date().toISOString() });
          const newTask = {
            __backendId: backendId,
            id: `task-${Date.now()}`,
            ...taskData,
            status: 'todo',
            created_at: new Date().toISOString(),
            completed_at: '',
            ai_recommendation: aiRec?.action || '',
            ai_reasoning: aiRec?.reason || ''
          };
          allTasks.push(newTask);
          result = { isOk: true };
        }
        localStorage.setItem('frobry_tasks', JSON.stringify(allTasks));
        updateUI();
      } else {
        // Data SDK mode
        if (taskId) {
          const existingTask = allTasks.find(t => t.__backendId === taskId);
          if (existingTask) {
            const aiRec = getAIRecommendation({ ...existingTask, ...taskData });
            result = await window.dataSdk.update({
              ...existingTask,
              ...taskData,
              ai_recommendation: aiRec?.action || '',
              ai_reasoning: aiRec?.reason || ''
            });
          }
        } else {
          const aiRec = getAIRecommendation({ ...taskData, created_at: new Date().toISOString() });
          result = await window.dataSdk.create({
            id: `task-${Date.now()}`,
            ...taskData,
            status: 'todo',
            created_at: new Date().toISOString(),
            completed_at: '',
            ai_recommendation: aiRec?.action || '',
            ai_reasoning: aiRec?.reason || ''
          });
        }
      }
      
      submitBtn.disabled = false;
      spinner.classList.add('hidden');
      
      if (result && result.isOk) {
        closeModal();
        showToast(taskId ? 'T√¢che modifi√©e' : 'T√¢che cr√©√©e', 'success');
      } else {
        showToast('Erreur lors de l\'enregistrement', 'error');
      }
    }
    
    function editTask(taskId) {
      openModal(taskId);
    }
    
    function deleteTask(taskId) {
      openDeleteModal(taskId);
    }
    
    async function confirmDelete() {
      if (!taskToDelete) return;
      
      const task = allTasks.find(t => t.__backendId === taskToDelete);
      if (!task) {
        closeDeleteModal();
        return;
      }
      
      const btn = document.getElementById('confirm-delete-btn');
      const spinner = document.getElementById('delete-spinner');
      
      btn.disabled = true;
      spinner.classList.remove('hidden');
      
      let result;
      
      if (window.isLocalMode) {
        const index = allTasks.findIndex(t => t.__backendId === taskToDelete);
        if (index > -1) {
          allTasks.splice(index, 1);
          localStorage.setItem('frobry_tasks', JSON.stringify(allTasks));
          result = { isOk: true };
        }
        updateUI();
      } else {
        result = await window.dataSdk.delete(task);
      }
      
      btn.disabled = false;
      spinner.classList.add('hidden');
      
      if (result.isOk) {
        showToast('T√¢che supprim√©e', 'success');
      } else {
        showToast('Erreur lors de la suppression', 'error');
      }
      
      closeDeleteModal();
    }
    
    async function completeTask(taskId) {
      const task = allTasks.find(t => t.__backendId === taskId);
      if (!task) return;
      
      let result;
      
      if (window.isLocalMode) {
        const updated = {
          ...task,
          status: 'completed',
          completed_at: new Date().toISOString()
        };
        const index = allTasks.findIndex(t => t.__backendId === taskId);
        allTasks[index] = updated;
        localStorage.setItem('frobry_tasks', JSON.stringify(allTasks));
        result = { isOk: true };
        updateUI();
      } else {
        result = await window.dataSdk.update({
          ...task,
          status: 'completed',
          completed_at: new Date().toISOString()
        });
      }
      
      if (result.isOk) {
        showToast('T√¢che compl√©t√©e !', 'success');
      } else {
        showToast('Erreur', 'error');
      }
    }
    
    async function restoreTask(taskId) {
      const task = allTasks.find(t => t.__backendId === taskId);
      if (!task) return;
      
      let result;
      
      if (window.isLocalMode) {
        const updated = {
          ...task,
          status: 'todo',
          completed_at: ''
        };
        const index = allTasks.findIndex(t => t.__backendId === taskId);
        allTasks[index] = updated;
        localStorage.setItem('frobry_tasks', JSON.stringify(allTasks));
        result = { isOk: true };
        updateUI();
      } else {
        result = await window.dataSdk.update({
          ...task,
          status: 'todo',
          completed_at: ''
        });
      }
      
      if (result.isOk) {
        showToast('T√¢che restaur√©e', 'success');
      } else {
        showToast('Erreur', 'error');
      }
    }
    
    // Toast
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      const successIcon = document.getElementById('toast-icon-success');
      const errorIcon = document.getElementById('toast-icon-error');
      
      toastMessage.textContent = message;
      successIcon.classList.toggle('hidden', type !== 'success');
      errorIcon.classList.toggle('hidden', type !== 'error');
      
      toast.classList.remove('translate-y-20', 'opacity-0');
      
      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
      }, 3000);
    }
    
    // Utilities
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    // Initialize
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bb5905dd03e9e85',t:'MTc2Nzk3ODc5Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
